---
- set_fact:
    certbot: "{{ microk8s | combine(microk8s_overwrite, recursive=True) }}"
  when: microk8s_overwrite is defined

- name: sudo snap install microk8s --classic
  snap:
    name:
      - microk8s
      - kubectl
      - helm3
    classic: yes
  become: yes

- name: wait for microk8s
  shell: microk8s status --wait-ready
  become: yes

- name: enable microk8s modules
  shell: microk8s enable {{microk8s['enable']}}
  become: yes
  when: microk8s['enable'] is defined

- name: install bash autocomplete
  apt:
    name: bash-completion
    state: present
  become: yes
